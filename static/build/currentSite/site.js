$((function(){function t(){$(".compare-add-link").on("click",(function(){var t=$(this);return"/compare"==t.attr("href")||($.getJSON(t.attr("href"),(function(e){t.html('<span class="glyphicon glyphicon-ok text-success"></span> В сравнении'),t.attr("href","/compare")})).fail((function(){alert("Ошибка сравнения товара")})),!1)})),$(".basket-add-order").on("click",(function(){productId=$(this).data("productid"),$.colorbox({href:"/basket/under-order?productId="+productId,width:600,maxWidth:"95%",close:"",className:"under-order",onComplete:function(){$.colorbox.resize(),$("#cboxLoadedContent input, #cboxLoadedContent button").on("blur",(function(){setTimeout((function(){$.colorbox.resize()}),350)}))}})})),$(".basket-add").on("click",(function(){var t=$(this);return $.getJSON(t.attr("href"),(function(e){t.parents(".basket-buttons").addClass("inbasket"),$(".basket-icon .quantity").removeClass("quantity-hide"),$(".basket-icon .quantity").text(e.quantity),t.data("type")&&"credit"==t.data("type")?yaCounter13674487.reachGoal("credit"):yaCounter13674487.reachGoal("order");try{rrApi.addToBasket(t.data("productid"))}catch(t){}e.item&&dataLayer.push({ecommerce:{add:{products:[{id:e.item.id,name:e.item.name,price:e.item.price}]}}})})).fail((function(){alert("Ошибка добавления товара")})),!1}))}function e(){$("#preloader").fadeIn();var e=$(".search-count");form=$("#filter"),$.post(form.attr("action"),form.serializeArray(),(function(o){e.length?e.text(o):$("#catalog-listing").html(o).promise().done((function(){t()})),$("#preloader").fadeOut()}))}$(".flex").flexMenu({linkText:"",linkTitle:"",showOnHover:!1}),$(".opinions-show-all").on("click",(function(){$(".product-opinions-hidden").show(),$(this).hide()})),$(".show-hide .link").on("click",(function(){link=$(this),parent=link.parents(".show-hide"),link.hasClass("link-show")?link.parents(".option").find(".hidden-filter").show():link.hasClass("link-hide")&&link.parents(".option").find(".hidden-filter").hide(),parent.find(".link").toggle()})),$(".range-type select").on("change",(function(){select=$(this),parent=select.parents(".range"),val=select.val(),"equals"==val?(parent.find(".from-to").hide(),parent.find(".equals").show()):"range"==val&&(parent.find(".equals").hide(),parent.find(".from-to").show())})),t(),$(".colorbox-stores").each((function(t){var e="store-"+$(this).data("store");$("."+e).colorbox({rel:e,transition:"fade",maxHeight:"95%",maxWidth:"95%",closeButton:!0,close:""})})),$(".colorbox").on("click",(function(){el=$(this);var t=parseInt($(this).data("height"))>0&&parseInt($(this).data("height")),e=parseInt($(this).data("width"))>0&&parseInt($(this).data("width")),o=$(this).data("href")?$(this).data("href"):$(this).attr("href"),i=!$(this).data("content");return $.colorbox({href:o,photo:i,scalePhotos:!0,fixed:!0,transition:"none",opacity:.5,width:e,height:t,maxHeight:"95%",maxWidth:"95%",close:""}),!1})),$(".retail-map-toggle").on("click",(function(){$(this).closest("div").find(".retail-map").toggle()})),$(".productGallery").colorbox({rel:"productGallery",transition:"fade",maxHeight:"95%",maxWidth:"95%",closeButton:!0,close:"",previous:"←",next:"→"}),$(".filter").find("input[type=checkbox],input[type=radio]").on("click",(function(){e()})),$(".filter").find("input[type=text]").on("blur",(function(){e()})),$(".filter-toggle").on("click",(function(){$(".filter-body").toggle()})),$("#form-subscription").on("submit",(function(){var t=$(".form-subscription-email").val();return $.post("/site/subscription",{email:t,source:"FOOTER",page:window.location.pathname},(function(e){var o=jQuery.parseJSON(e);$(".form-subscription-before").hide(),$(".form-subscription-after").text(o.message),$(".form-subscription-after").show(),"Благодарим за подписку :)"==o.message&&(window.rrApiOnReady=window.rrApiOnReady||[]).push((function(){rrApi.setEmail(t)}))})),!1})),$('[data-toggle="tooltip"]').tooltip(),$((function(){var t=$(".grid").imagesLoaded((function(){t.masonry({percentPosition:!0,gutter:20})}))})),$(".show-stores").click((function(){$(this).hide(),$(".js-address").removeClass("address--hidden"),$(".colorbox-stores").each((function(t){var e="images-"+$(this).data("store");$("."+e)[0].slick.refresh()}))})),$(".navbar-collapse").on("show.bs.collapse",(function(t){$(".js-blackout").show()})),$(".navbar-collapse").on("hide.bs.collapse",(function(t){$(".js-blackout").hide()})),$(".buy-one-click").on("click",(function(){productId=$(this).data("productid"),$.colorbox({href:"/basket/one-click?productId="+productId,width:600,height:500,maxWidth:"95%",close:"",className:"one-click",onComplete:function(){}})})),$(".email-boss-button").on("click",(function(){return $.colorbox({href:"/site/email-boss",width:600,height:500,maxWidth:"95%",close:"",className:"email-boss",onComplete:function(){}}),!1})),$.getScript("//vk.com/js/api/openapi.js?121").then((function(){VK.Widgets.Group("vk_groups",{mode:2,width:"auto",height:"260"},76684069)})),$(".change-region").on("click",(function(){var t=$(this).data("regionid");$("#preloader").fadeIn(),$.get("/site/set-region?setRegionId="+t,(function(){location.reload()}))}))}));